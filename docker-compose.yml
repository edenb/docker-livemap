version: '2'
services:
  db:
    image: postgres
    ports:
    - "5432:5432"
    volumes:
    - postgresdb:/var/lib/postgresql/data
    - initdb:/docker-entrypoint-initdb.d
    restart: always
  mqtt:
    image: eclipse-mosquitto
    ports:
    - "1883:1883"
    volumes:
    - mqtt-config:/mosquitto/config
    - mqtt-data:/mosquitto/data
    - mqtt-log:/mosquitto/log
    restart: always
  web:
    image: edenb/livemap
    #build:
    #  context: ../livemap
    #  dockerfile: Dockerfile
    ports:
    - "3000:3000"
    volumes:
    - initdb:/src/initdb
    - ./overlays:/src/staticlayers:ro
    - ./tracks:/src/tracks:ro
    links:
    - db
    - mqtt
    environment:
      C_DB_URL: 'postgres://livemap:livemap@db/livemapdb'
      C_SERVER_PORT: '3000'
      C_FORCESSL: 'false'
      C_MQTT_URL: 'mqtt://mqtt:1883'
      C_MQTT_TOPIC: 'livemap/#'
      C_WCLIENT_NAME: 'Livemap'
      C_WCLIENT_LICENSE: 'MIT'
      C_WCLIENT_ABOUT: 'This is a demo of Livemap'
    restart: always
volumes:
  initdb:
  postgresdb:
  mqtt-config:
  mqtt-data:
  mqtt-log:
